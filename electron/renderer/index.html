<!DOCTYPE html>
<html>
<head>
    <title>DXF Viewer</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="header">
        <div class="header-left">
            <button class="btn btn-primary" id="openBtn">Open DXF File</button>
            <div id="fileInfo" class="file-info hidden">
                <div class="file-name" id="fileName">147926.dxf</div>
                <div class="file-size" id="fileSize">81.12 kB</div>
            </div>
        </div>
        <div class="header-right">
            <div class="app-title">Lasercomb GmbH</div>
            <div class="app-version">V1.0.0</div>
        </div>
        <div class="controls">
            <button class="btn btn-secondary" id="clearBtn">Clear</button>
            <button class="btn btn-secondary" id="fitBtn">Fit to View</button>
            <button class="btn btn-secondary" id="togglePanelBtn">
                <span id="panelToggleIcon">‚óÄ</span>
            </button>
        </div>
    </div>
    
    <div class="main-content">
        <div class="viewer-container">
            <div id="viewer"></div>
            <div id="dropZone" class="drop-zone">
                <div class="drop-content">
                    <div class="drop-icon">üìÅ</div>
                    <div class="drop-text">Drop DXF file here</div>
                    <div class="drop-subtext">or use File ‚Üí Open DXF File</div>
                </div>
            </div>
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <div>Loading DXF file...</div>
            </div>
            <div id="status" class="status">Ready - Open a DXF file to begin</div>
        </div>
        
        <div id="sidePanel" class="side-panel">
            <div class="resize-handle" id="resizeHandle"></div>
            <div class="panel-header">
                <h3>Import</h3>
            </div>
            <div class="panel-content">
                <div id="importTab" class="tab-content active">
                    <div id="layerTable" class="layer-table">
                        <div class="no-file">
                            Load a DXF file to view layers
                        </div>
                    </div>
                    <div id="drawingInfo" class="drawing-info" style="display: none;">
                        <div class="info-item">
                            <span class="info-label">Drawing Size:</span>
                            <span id="drawingDimensions" class="info-value">N/A</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Units:</span>
                            <span id="drawingUnits" class="info-value">N/A</span>
                        </div>
                    </div>
                    <div class="export-section">
                        <button id="exportLayersBtn" class="btn btn-secondary" disabled>
                            Export Layer Mapping
                        </button>
                        <button id="createImportFilterBtn" class="btn btn-primary" disabled>
                            Create Import Filter
                        </button>
                    </div>
                </div>
                <div id="outputTab" class="tab-content">
                    <div class="mapping-content">
                        <p>Layer mapping functionality coming soon...</p>
                    </div>
                </div>
                <div id="settingsTab" class="tab-content">
                    <div class="settings-content">
                        <h4>Application Settings</h4>
                        
                        <div class="settings-section">
                            <h5>Display Units</h5>
                            <p>Override DXF units and display dimensions in your preferred units.</p>
                            <div class="unit-selector">
                                <label for="unitOverride">Display units:</label>
                                <select id="unitOverride" class="form-select">
                                    <option value="auto">Auto (Use DXF units)</option>
                                    <option value="mm">Millimeters (mm)</option>
                                    <option value="cm">Centimeters (cm)</option>
                                    <option value="m">Meters (m)</option>
                                    <option value="in">Inches (in)</option>
                                    <option value="ft">Feet (ft)</option>
                                </select>
                            </div>
                            
                            <div class="scaling-selector">
                                <label class="scaling-label">Scaling factor:</label>
                                <p class="scaling-description">Apply scaling when DXF was exported with incorrect scale.</p>
                                <select id="scalingDropdown" class="form-select">
                                    <option value="1">1:1 (No scaling)</option>
                                    <option value="2">2:1 (√ó2)</option>
                                    <option value="5">5:1 (√ó5)</option>
                                    <option value="10">10:1 (√ó10)</option>
                                    <option value="20">20:1 (√ó20)</option>
                                    <option value="50">50:1 (√ó50)</option>
                                    <option value="100">100:1 (√ó100)</option>
                                    <option value="0.5">1:2 (√∑2)</option>
                                    <option value="0.2">1:5 (√∑5)</option>
                                    <option value="0.1">1:10 (√∑10)</option>
                                    <option value="0.05">1:20 (√∑20)</option>
                                    <option value="0.02">1:50 (√∑50)</option>
                                    <option value="0.01">1:100 (√∑100)</option>
                                    <option value="custom">Custom...</option>
                                </select>
                                
                                <!-- Custom scaling input container -->
                                <div id="customScalingContainer" class="custom-scaling-container" style="display: none;">
                                    <div class="custom-scaling-input-group">
                                        <label for="customScalingInput">Enter custom scaling factor:</label>
                                        <input type="number" id="customScalingInput" class="form-input" step="0.001" min="0.001" max="1000" placeholder="e.g., 1.5, 25, 0.75">
                                        <div class="custom-scaling-help">
                                            Examples: 1.5 (√ó1.5), 25 (√ó25), 0.75 (√∑1.33)
                                        </div>
                                    </div>
                                    
                                    <div class="custom-scaling-buttons">
                                        <button id="applyCustomScaling" class="btn btn-small btn-primary">Apply</button>
                                        <button id="saveCustomScaling" class="btn btn-small btn-secondary">Save to List</button>
                                        <button id="cancelCustomScaling" class="btn btn-small btn-tertiary">Cancel</button>
                                    </div>
                                    
                                    <div id="customScalingError" class="custom-scaling-error" style="display: none;">
                                        Please enter a valid number between 0.001 and 1000
                                    </div>
                                </div>
                                
                                <!-- Overall Size Display -->
                                <div id="overallSizeInfo" class="overall-size-info" style="display: none;">
                                    <label class="size-label">Overall Size:</label>
                                    <div id="overallDimensions" class="size-value">N/A</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h5>Line Types Management</h5>
                            <p>Configure and manage internal line types for processing.</p>
                            <button class="btn btn-primary" id="lineTypesBtn">Manage Line Types</button>
                        </div>
                        
                        <div class="settings-section">
                            <h5>Import Filters</h5>
                            <p>Create mapping profiles to convert DXF layers and colors to internal line types.</p>
                            <button class="btn btn-primary" id="importFiltersBtn">Manage Import Filters</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-tabs">
                <button class="tab-button active" data-tab="import">Import</button>
                <button class="tab-button" data-tab="output">Output</button>
                <button class="tab-button" data-tab="settings">Settings</button>
            </div>
        </div>
    </div>

    <!-- Profile Name Modal -->
    <div id="profileModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Save Layer Mapping Profile</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body">
                <label for="profileNameInput">Profile Name:</label>
                <input type="text" id="profileNameInput" placeholder="Enter profile name..." />
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modalCancel">Cancel</button>
                <button class="btn btn-primary" id="modalSave">Save</button>
            </div>
        </div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "../../node_modules/three/build/three.module.js",
            "three/": "../../node_modules/three/",
            "loglevel": "../../loglevel-wrapper.js",
            "opentype.js": "../../node_modules/opentype.js/dist/opentype.module.js",
            "earcut": "../../node_modules/earcut/src/earcut.js"
        }
    }
    </script>
    <script type="module" src="renderer.js"></script>
</body>
</html>